关于三次握⼿手与四次挥⼿手⾯面试官想考我们什什么？
在⾯面试中，三次握⼿手和四次挥⼿手可以说是问的最频繁的⼀一个知识点了了，我相信⼤大家也都看过很多关于三次握⼿手与四次挥手的⽂文章，今天的这篇⽂文章，重点是围绕着⾯面试，我们应该掌握哪些比较重要的点，哪些是比较被⾯试官给问到的，我觉得如果你能把我下⾯列列举的⼀一些点都记住、理理解，我想就差不不多了了。
三次握⼿手
当⾯面试官问你为什什么需要有三次握⼿手、三次握⼿手的作⽤用、讲讲三次三次握⼿手的时候，我想很多⼈人会这样
回答：
⾸首先很多⼈人会先讲下握⼿手的过程：
1、第⼀一次握⼿手：客户端给服务器器发送⼀一个 SYN 报⽂文。
2、第⼆二次握⼿手：服务器器收到 SYN 报⽂文之后，会应答⼀一个 SYN+ACK 报⽂文。
3、第三次握⼿手：客户端收到 SYN+ACK 报⽂文之后，会回应⼀一个 ACK 报⽂文。
4、服务器器收到 ACK 报⽂文之后，三次握⼿手建⽴立完成。
作⽤用是为了了确认双⽅方的接收与发送能⼒力力是否正常。
这⾥里里我顺便便解释⼀一下为啥只有三次握⼿手才能确认双⽅方的接受与发送能⼒力力是否正常，⽽而两次却不不可以：
第⼀一次握⼿手：客户端发送⽹网络包，服务端收到了了。这样服务端就能得出结论：客户端的发送能
⼒力力、服务端的接收能⼒力力是正常的。
第⼆二次握⼿手：服务端发包，客户端收到了了。这样客户端就能得出结论：服务端的接收、发送能
⼒力力，客户端的接收、发送能⼒力力是正常的。不不过此时服务器器并不不能确认客户端的接收能⼒力力是否正常。
第三次握⼿手：客户端发包，服务端收到了了。这样服务端就能得出结论：客户端的接收、发送能⼒力力正常，服务器器⾃自⼰己的发送、接收能⼒力力也正常。因此，需要三次握⼿手才能确认双⽅方的接收与发送能⼒力力是否正常。
这样回答其实也是可以的，但我觉得，这个过程的我们应该要描述的更更详细⼀一点，因为三次握⼿手的过程
中，双⽅方是由很多状态的改变的，⽽而这些状态，也是⾯面试官可能会问的点。所以我觉得在回答三次握⼿手
的时候，我们应该要描述的详细⼀一点，⽽而且描述的详细⼀一点意味着可以扯久⼀一点。加分的描述我觉得应
该是这样：
刚开始客户端处于 closed 的状态，服务端处于 listen 状态。然后
1、第⼀一次握⼿手：客户端给服务端发⼀一个 SYN 报⽂文，并指明客户端的初始化序列列号 ISN(c)。此时客户端
处于 SYN_Send 状态。
2、第⼆二次握⼿手：服务器器收到客户端的 SYN 报⽂文之后，会以⾃自⼰己的 SYN 报⽂文作为应答，并且也是指定了了
⾃自⼰己的初始化序列列号 ISN(s)，同时会把客户端的 ISN + 1 作为 ACK 的值，表示⾃自⼰己已经收到了了客户端的
SYN，此时服务器器处于 SYN_REVD 的状态。
3、第三次握⼿手：客户端收到 SYN 报⽂文之后，会发送⼀一个 ACK 报⽂文，当然，也是⼀一样把服务器器的 ISN +
1 作为 ACK 的值，表示已经收到了了服务端的 SYN 报⽂文，此时客户端处于 establised 状态。
4、服务器器收到 ACK 报⽂文之后，也处于 establised 状态，此时，双⽅方以建⽴立起了了链接。
三次握⼿手的作⽤用
三次握⼿手的作⽤用也是有好多的，多记住⼏几个，保证不不亏。例例如：
1、确认双⽅方的接受能⼒力力、发送能⼒力力是否正常。
2、指定⾃自⼰己的初始化序列列号，为后⾯面的可靠传送做准备。



单单这样还不不⾜足以应付三次握⼿手，⾯面试官可能还会问⼀一些其他的问题，例例如：

1、（ISN）是固定的吗
三次握⼿手的⼀一个重要功能是客户端和服务端交换ISN(Initial Sequence Number), 以便便让对⽅方知道接下来接收数据的时候如何按序列列号组装数据。如果ISN是固定的，攻击者很容易易猜出后续的确认号，因此 ISN 是动态⽣生成的。
2、什什么是半连接队列列
服务器器第⼀一次收到客户端的 SYN 之后，就会处于 SYN_RCVD 状态，此时双⽅方还没有完全建⽴立其连接，服务器器会把此种状态下请求连接放在⼀一个队列列⾥里里，我们把这种队列列称之为半连接队列列。当然还有⼀一个全连接队列列，就是已经完成三次握⼿手，建⽴立起连接的就会放在全连接队列列中。如果队列列满了了就有可能会出现丢包现象。
这⾥里里在补充⼀一点关于SYN-ACK 重传次数的问题：　服务器器发送完SYN－ ACK包，如果未收到客户确认包，服务器器进⾏行行⾸首次重传，等待⼀一段时间仍未收到客户确认包，进⾏行行第⼆二次重传，如果重传次数超 过系统规定的最⼤大重传次数，系统将该连接信息从半连接队列列中删除。注意，每次重传等待的时间不不⼀一定相同，⼀一般会是指数增⻓长，例例如间隔时间为 1s, 2s, 4s, 8s, ....
3、三次握⼿手过程中可以携带数据吗
很多⼈人可能会认为三次握⼿手都不不能携带数据，其实第三次握⼿手的时候，是可以携带数据的。也就是说，第⼀一次、第⼆二次握⼿手不不可以携带数据，⽽而第三次握⼿手是可以携带数据的。
为什什么这样呢？⼤大家可以想⼀一个问题，假如第⼀一次握⼿手可以携带数据的话，如果有⼈人要恶意攻击服务器器，那他每次都在第⼀一次握⼿手中的 SYN 报⽂文中放⼊入⼤大量量的数据，因为攻击者根本就不不理理服务器器的接收、发送能⼒力力是否正常，然后疯狂着重复发 SYN 报⽂文的话，这会让服务器器花费很多时间、内存空间来接收这些报⽂文。也就是说，第⼀一次握⼿手可以放数据的话，其中⼀一个简单的原因就是会让服务器器更更加容易易受到攻击了了。⽽而对于第三次的话，此时客户端已经处于 established 状态，也就是说，对于客户端来说，他已经建⽴立起连接了了，并且也已经知道服务器器的接收、发送能⼒力力是正常的了了，所以能携带数据⻚页没啥⽑毛病。



关于三次握⼿手的， https 的认证过程能知道⼀一下最好，不不过我就不不说了了，留留着写 http ⾯面试相关时的⽂文章再说。



四次挥⼿
四次挥⼿也⼀一样，千万不不要对⽅方⼀一个 FIN 报⽂文，我⽅方⼀一个 ACK 报⽂文，再我⽅方⼀一个 FIN 报⽂文，我⽅方⼀一个ACK 报⽂文。然后结束，最好是说的详细⼀一点，例例如想下面这样就差不多了了，要把每个阶段的状态记好，我上次⾯面试就被问了几个了，呵呵。我答错了了，还以为⾃自己答对了了，当时还解释的头头是道，呵呵。刚开始双⽅方都处于 establised 状态，假如是客户端先发起关闭请求，则：
1、第一次挥手：客户端发送⼀一个 FIN 报⽂文，报⽂文中会指定⼀一个序列列号。此时客户端处于FIN_WAIT1状态。
2、第二次握手：服务端收到 FIN 之后，会发送 ACK 报⽂文，且把客户端的序列列号值 + 1 作为 ACK 报⽂文的序列列号值，表明已经收到客户端的报⽂文了了，此时服务端处于 *CLOSE_WAIT2状态。
3、第三次挥手：如果服务端也想断开连接了了，和客户端的第⼀一次挥⼿手⼀一样，发给 FIN 报⽂文，且指定一个序列列号。此时服务端处于 LAST_ACK 的状态。
4、第四次挥⼿手：客户端收到 FIN 之后，⼀一样发送⼀一个 ACK 报⽂文作为应答，且把服务端的序列列号值 + 1作为⾃自⼰己 ACK 报⽂文的序列列号值，此时客户端处于 TIME_WAIT 状态。需要过⼀一阵⼦子以确保服务端收到⾃己的 ACK 报⽂文之后才会进⼊入 CLOSED 状态
5、服务端收到 ACK 报⽂文之后，就处于关闭连接了了，处于 CLOSED 状态。这⾥里里特别需要主要的就是TIME_WAIT这个状态了了，这个是⾯面试的⾼高频考点，就是要理理解，为什什么客户端
发送 ACK 之后不不直接关闭，⽽而是要等⼀一阵⼦子才关闭。这其中的原因就是，要确保服务器器是否已经收到了我们的 ACK 报⽂文，如果没有收到的话，服务器器会重新发 FIN 报⽂文给客户端，客户端再次收到 ACK 报⽂之后，就知道之前的 ACK 报⽂文丢失了了，然后再次发送 ACK 报⽂文。
至于 TIME_WAIT 持续的时间⾄至少是⼀一个报⽂文的来回时间。⼀一般会设置⼀一个计时，如果过了了这个计时没有再次收到 FIN 报⽂文，则代表对⽅方成功就是 ACK 报⽂文，此时处于 CLOSED 状态。
这⾥里里我给出每个状态所包含的含义，有兴趣的可以看看。



LISTEN - 侦听来⾃自远⽅方TCP端⼝口的连接请求；
SYN-SENT -在发送连接请求后等待匹配的连接请求；
SYN-RECEIVED - 在收到和发送⼀一个连接请求后等待对连接请求的确认；
ESTABLISHED- 代表⼀一个打开的连接，数据可以传送给⽤用户；
FIN-WAIT-1 - 等待远程TCP的连接中断请求，或先前的连接中断请求的确认；
FIN-WAIT-2 - 从远程TCP等待连接中断请求；
CLOSE-WAIT - 等待从本地⽤用户发来的连接中断请求；
CLOSING -等待远程TCP对连接中断的确认；
LAST-ACK - 等待原来发向远程TCP的连接中断请求的确认；
TIME-WAIT -等待⾜足够的时间以确保远程TCP接收到连接中断请求的确认；
CLOSED - 没有任何连接状态；
最后，在放在三次握⼿手与四次挥⼿手的图

![1597300055762](C:\Users\冰王子\AppData\Roaming\Typora\typora-user-images\1597300055762.png)

学习更更多算法 + 计算机基础知识，欢迎关注我的微信公众号，每天准时推送技术⼲干货 



